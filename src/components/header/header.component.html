<div 
  class="absolute bg-slate-800/50 backdrop-blur-lg border rounded-lg shadow-2xl flex flex-col animate-open-window"
  [style.z-index]="windowInstance().zIndex"
  [style.left.px]="windowInstance().position.x"
  [style.top.px]="windowInstance().position.y"
  [style.width.px]="windowInstance().size.width"
  [style.height.px]="windowInstance().size.height"
  [class.border-violet-500/80]="isActive()"
  [class.border-slate-700/50]="!isActive()"
  [class.transition-[width,height,top,left]]="windowInstance().isMaximized"
  [class.duration-300]="windowInstance().isMaximized"
  [class.ease-in-out]="windowInstance().isMaximized"
  (mousedown)="onFocus()">
  
  <!-- Title Bar -->
  <header 
    class="h-9 px-3 flex items-center justify-between flex-shrink-0 border-b"
    [class.cursor-move]="!windowInstance().isMaximized"
    [class.cursor-default]="windowInstance().isMaximized"
    [class.border-slate-700/50]="!isActive()"
    [class.border-violet-500/80]="isActive()"
    (mousedown)="onDragStart($event)">
    <div class="flex items-center space-x-2">
      <button (click)="onClose($event)" class="window-control w-3.5 h-3.5 bg-red-500 rounded-full hover:bg-red-400 transition-colors"></button>
      <div class="window-control w-3.5 h-3.5 bg-yellow-500 rounded-full cursor-not-allowed"></div>
      <button (click)="onMaximize($event)" class="window-control w-3.5 h-3.5 bg-green-500 rounded-full hover:bg-green-400 transition-colors"></button>
    </div>
    <div class="text-sm font-medium flex items-center transition-colors" [class.text-white]="isActive()" [class.text-slate-300]="!isActive()">
      <i class="fas {{ windowInstance().app.icon }} mr-2 text-xs"></i>
      <span>{{ windowInstance().app.name }}</span>
    </div>
    <div class="w-16"></div> <!-- Spacer -->
  </header>

  <!-- Content -->
  <div class="flex-grow p-1 overflow-auto bg-slate-900/40 rounded-b-md">
    <div class="p-4 h-full w-full content-fade-in">
        <ng-content></ng-content>
    </div>
  </div>

  <!-- Resize Handle -->
  @if(!windowInstance().isMaximized) {
    <div 
      class="absolute bottom-0 right-0 w-4 h-4 cursor-se-resize"
      (mousedown)="onResizeStart($event)">
      <i class="fas fa-grip-lines-vertical text-slate-600/50 transform rotate-45 absolute -bottom-1 -right-1"></i>
    </div>
  }
</div>